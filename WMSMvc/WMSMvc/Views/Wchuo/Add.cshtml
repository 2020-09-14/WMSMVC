
@{
    ViewData["Title"] = "Add";
}
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <link href="~/css/site.css" rel="stylesheet" />
    <link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>
</head>

<body>
    <table id="studentList" class="table table-bordered">
        <tr>
            <td>选择</td>
            <td>商品编号</td>
            <td>商品名称</td>
            <td>商品规格</td>
            <td>库存可用数量</td>
            <td>调用数量</td>
        </tr>
        <tbody id="tbb">
        </tbody>
    </table>
    <div>
        出库原因: <select id="Select1" class="btn btn-primary dropdown-toggle" >
            <option>请选择！</option>
            <option>线下销售</option>
            <option>送往食堂</option>
            <option>其他</option>
        </select>
        <br /><br />
        任务备注：<input  type="text" width="200"  />
       
    </div>
  
    <input type="button" id="iee" value="提交" class="btn btn-outline-primary" onclick="studInfo()" />
</body>


</html>

<script>//ex_GoodsTWOId
    $(function () {
        Motai();
       
    })
    
    function Motai() {
        $.ajax({
            url: 'http://localhost:3687/api/GoodsXuan',
            type: "get",
            success: function (d) {
                $(d).each(function () {
                    var line = '<tr>'
                        + '<td><input id="box" name="box" value="' + this.ex_GoodsTWOId + '" type="checkbox" /></td>'
                        + '<td>' + this.coding + '</td>'
                        + '<td>' + this.gWname + '</td>'
                        + '<td>' + this.specification + '</td>'
                        + '<td>' + this.twOsum + '</td>'
                        + '<td><input type="text" name="bos" /></td>'
                        + '</tr>'
                    $("#tbb").append(line)
                })
            }
        })
    }
    function studInfo() {
        var rows = document.getElementById("studentList").rows;//获取table行数
        var a = document.getElementsByName("box");//复选框name
        var b = document.getElementsByName("bos");//文本框name
        var Cause = $("#Select1").val();
        if (Cause == "请选择！") {
            alert('请选择出库原因！');
            return;
        }
        var obj = {};
        obj.Cause = Cause;
        var studentList = new Array();
        for (var i = 0; i < a.length; i++) {
            if (a[i].checked) {
                var row = a[i].parentElement.parentElement.rowIndex;//被选中行

                var ex_GoodsTWOId = a[i].value;//复选框值
                var coding = rows[row].cells[1].innerHTML;//table列表i行第一列值
                var gWname = rows[row].cells[2].innerHTML;
                var specification = rows[row].cells[3].innerHTML;
                var twOsum = rows[row].cells[4].innerHTML;
                var sum = b[i].value;
                var student = {};

                student.ex_GoodsTWOId = ex_GoodsTWOId;
                student.coding = coding;
                student.gWname = gWname;
                student.specification = specification;
                student.twOsum = twOsum;
                student.sum = sum
                studentList.push(student);

            }
        }
        studentList.push(obj);

        $.ajax({
            url: 'http://localhost:3687/api/Ceshi',
            type: "post",
            contentType: "application/json",
            dataType: "json",
            //data:  JSON.stringify(studentList) ,
            data: JSON.stringify(studentList),
            success: function (d) {
                if (d > 0) {
                    alert('添加成功！')
                }
                else {
                    location.href = "/Shared/Error"
                }
            }
        })
    }
</script>
